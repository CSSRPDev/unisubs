{% extends "future/base.html" %}
{% load i18n new_subtitles_tags ui query_string %}
{% load url from future %}

{% block head-extra %}
{% include "future/videos/embed-script.html" %}
{% endblock %}

{% block header %}{% if header %}{{ header }}{% else %}{{ block.super }}{% endif %}{% endblock %}

{% block content %}
<section>
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-8"><a href="{{video.get_absolute_url}}{% query_string %}"><i class="icon icon-back"></i>{% trans "Return to Video" %}</a>
        <div class="content">
          {% include "future/videos/embed.html" with width=848 height=477 url=video.get_video_url %}
          <h2>{{video.title_display}}</h2>
          <ul class="nav nav-tabs">
            <li class="active"><a href="#subtitles_list" data-toggle="tab" aria-expanded="true">{% trans "Subtitles" %}</a></li>
            <li><a href="#subtitles_info" data-toggle="tab" aria-expanded="false">{% trans "Subtitles info" %}</a></li>
            <li><a href="#subtitles_activity" data-toggle="tab">{% trans "Activity" %}</a></li>
            <li><a href="#subtitles_comments" data-toggle="tab">{% trans "Comments" %}</a></li>
          </ul>
          <div class="tab-content">
            <div id="subtitles_list" class="tab-pane active">
              <nav class="tab-actions">
                {% if show_rollback %}
                <a {% if can_edit %}class="button small ajaxLink" href="{% query_string form=rollback %}"{% else %}class="button small disabled"{% endif %}>{% blocktrans with number=subtitle_version.version_number  %}Rollback to version {{ number }}{% endblocktrans %}</a>
                {% else %}
                <a {% if can_edit %}class="button small" href="{{ subtitle_language.editor_url }}"{% else %}class="button small disabled"{% endif %}>{% trans "Edit subtitles" %}</a>
                {% endif %}
              </nav>
              {% if subtitle_version and subtitle_version.has_subtitles %}
              {{ subtitle_version|render_subtitles }}
              {% else %}
              <div class="zero-state">{% trans "No subtitles available." %}</div>
              {% endif %}
            </div>
            <div id="subtitles_info" class="tab-pane">
              {% include "future/videos/tabs/info.html" %}
            </div>
            <div id="subtitles_activity" class="tab-pane">
              {% include "future/videos/tabs/activity.html" %}
            </div>
            <div id="subtitles_comments" class="tab-pane">
              {% include "future/videos/tabs/comments.html" %}
            </div>
          </div>
        </div>
      </div>

      <div class="col-xs-12 col-sm-4">
        <div class="content">
          <section class="videoSubtitles-progress">
            <header>
              <h1>{% blocktrans with language=subtitle_language.get_language_code_display %}{{ language }} subtitles{% endblocktrans %}</h1>
              {% if subtitle_version and subtitle_version.has_subtitles %}
              <div class="header-actions dropdown">
                <button id="download-button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{% trans "Download" %}<span class="caret"></span></button>
                <ul class="dropdown-menu" aria-labeledby="download-button">
                  {% for format_name in downloadable_formats %}
                  <li><a href="{% subtitle_download_url subtitle_version format_name %}">{{format_name|upper}}</a></li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
            </header>
            {% if steps %}
            <ol>
              {% for step in steps %}
              <li{% if step.current %} class="current"{% endif %}>
                <span class="col-xs-6">{{ step.label }}</span>
                <span class="col-xs-6">
                  {% if step.user %}
                  {% include "future/users/icon-link.html" with user=step.user %}
                  {% elif step.team %}
                  {% include "future/teams/icon-link.html" with team=step.team %}
                  {% else %}
                  <i class="icon {{ step.icon}}"></i>
                  {% endif %}
                  {{ step.status }}
                </span>
              </li>
              {% endfor %}
            </ol>
            {% else %}
            <ol>
              {% if subtitle_language.subtitles_complete %}
              <li>
                <span class="col-xs-6">{% trans "Subtitles" %}</span>
                <span class="col-xs-6">{% trans "Complete" %}</span>
              </li>
              {% else %}
              <li class="current">
                <span class="col-xs-6">{% trans "Subtitles" %}</span>
                <span class="col-xs-6">{% trans "In progress" %}</span>
              </li>
              {% endif %}
            </ol>
            {% endif %}
            {% if cta %}{{ cta }}{% endif %}
          </section>
          {% if all_subtitle_versions %}
          <section class="videoSubtitles-revisions">
            <header>
              <h3>{% trans "Revisions" %}</h3>
              <div class="header-actions"><a href="#" class="videoSubtitles-compare disabled text" data-url-template="{% url "videos:diffing" "111" "222" %}" title="{% trans "Compare revisions" %}">{% trans "Compare revisions" %}</a></div>
            </header>
            <ul>
              {% for revision in all_subtitle_versions %}
              <li class="row condensed hangingLink{% if revision == subtitle_version %} currentRevision{% endif %}">
                {% if enabled_compare %}
                <div class="col-xs-1">
                  <div class="checkbox">
                    <input type="checkbox" id="revision-{{revision.id}}" data-id="{{ revision.id }}">
                    <label for="revision-{{ revision.id }}"><span></span></label>
                  </div>
                </div>
                <div class="col-xs-6">
                {% else %}
                <div class="col-xs-7">
                {% endif %}
                <a class="text" href="{{ revision.get_absolute_url }}{% query_string %}">
                  {% if revision.is_private %}<em class="italic">{% else %}<strong>{% endif %}
                      {% blocktrans with number=revision.version_number %}Revision {{ number }}{% endblocktrans %}
                  {% if revision.is_private %}</em>{% else %}</strong>{% endif %}
                </a>
                  <br>
                  {{ revision.author }}
                </div>
                <div class="col-xs-5 end-xs">
                  <strong>{{ revision.get_origin_display }}</strong>
                  <br>
                  {{ revision.created|elapsed_time }}
                </div>
                {% if enable_edit_in_admin %}
                <a class="hangingLink-link" href="{% url "admin:subtitles_subtitleversion_change" revision.id %}" target="_blank"><i class="icon icon-edit"></i></a>
                {% endif %}
              </li>
              {%  endfor %}
            </ul>
            {% if has_private_version %}
            <p><em class="italic">{% trans "Private revisions are in italics." %}</em></p>
            {% endif %}
            {% if enable_delete_subtitles %}
            <p class="text-right"><a class="ajaxLink" href="{% query_string form=delete %}">{% trans "Delete subititles" %}</a></p>
            {% endif %}
            </section>
          {% else %}
          <section class="videoSubtitles-revisions">
              <div class="zero-state">{% trans "No revisions available." %}</div>
          </section>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
